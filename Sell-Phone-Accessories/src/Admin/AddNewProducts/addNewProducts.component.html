<!-- Top bar -->

<div class="grid">
  <!-- LEFT COLUMN: Gallery + toggles -->
  <div class="left-col">
    <div class="card gallery">
      <div class="cover" *ngIf="images().length; else emptyState">
        <img [src]="images()[coverIndex()]?.url" alt="Cover" />
        <span class="badge">Cover</span>
      </div>
      <ng-template #emptyState>
        <div class="empty">
          <div class="ico">üñºÔ∏è</div>
          <div>No image yet</div>
        </div>
      </ng-template>

      <!-- thumbnails -->
      <div class="thumbs">
        <button
          type="button"
          class="thumb"
          *ngFor="let img of images(); index as i"
          (click)="setCover(i)"
          [class.active]="i === coverIndex()"
        >
          <img [src]="img.url" alt="thumb" />
          <div class="thumb-actions" (click)="$event.stopPropagation()">
            <button
              type="button"
              class="icon-btn"
              (click)="removeImage(i)"
              aria-label="Remove image"
            >
              ‚úï
            </button>
          </div>
        </button>

        <!-- add tile -->
        <label class="thumb add-tile">
          <input
            #fileInp
            type="file"
            accept="image/*"
            multiple
            (change)="onFilesSelected($event)"
            hidden
          />
          <div>Ôºã</div>
          <span>Add</span>
        </label>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Visibility</div>
      <p class="muted">
        You can change the visibility of this product for customers
      </p>
      <label class="toggle">
        <input type="checkbox" [formControl]="form.controls.visible" />
        <span class="track"><span class="thumb"></span></span>
        <span class="lbl">Visible</span>
      </label>
    </div>

    <div class="card">
      <div class="card-title">Preview</div>
      <button type="button" class="btn-outline">Preview</button>
    </div>
  </div>

  <!-- MIDDLE COLUMN: Related items -->
  <!-- MIDDLE COLUMN: Technical Specs -->
  <div class="mid-col">
    <div class="card">
      <div class="card-title">
        <span>Technical Specs</span>
      </div>

      <div class="form-grid">
        <!-- Features (textarea) -->
        <div class="field col-span-2">
          <label class="field-label" for="specFeatures">Features</label>
          <div class="pill pill-textarea">
            <textarea
              id="specFeatures"
              #specInput
              data-key="Features"
              rows="3"
              placeholder="Example: Shock-absorbing corners, raised edges, MagSafe compatible‚Ä¶"
            ></textarea>
          </div>
        </div>

        <!-- Compatibility -->
        <div class="field col-span-2">
          <label class="field-label" for="specCompat">Compatibility</label>
          <div class="pill">
            <input
              id="specCompat"
              type="text"
              #specInput
              data-key="Compatibility"
              placeholder="Example: iPhone 15 / 15 Pro / 15 Plus"
            />
          </div>
        </div>

        <!-- Dimensions -->
        <div class="field">
          <label class="field-label" for="specDim">Dimensions</label>
          <div class="pill">
            <input
              id="specDim"
              type="text"
              #specInput
              data-key="Dimensions"
              placeholder="Example: 151 x 76 x 12 mm"
            />
          </div>
        </div>

        <!-- Weight -->
        <div class="field">
          <label class="field-label" for="specWeight">Weight</label>
          <div class="pill">
            <input
              id="specWeight"
              type="text"
              #specInput
              data-key="Weight"
              placeholder="Example: 38 g"
            />
          </div>
        </div>

        <!-- Materials -->
        <div class="field col-span-2">
          <label class="field-label" for="specMat">Materials</label>
          <div class="pill">
            <input
              id="specMat"
              type="text"
              #specInput
              data-key="Materials"
              placeholder="Example: Polycarbonate, TPU, Silicone"
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT COLUMN: Product details -->
  <div class="right-col">
    <div class="card">
      <div class="card-title">Product Details</div>

      <form class="details-form" [formGroup]="form" (ngSubmit)="publish()">
        <!-- Segmented tabs (HTML thu·∫ßn) -->
        <div class="seg-tabs">
          <input type="radio" id="tab-general" name="tabs" checked />
          <label for="tab-general">General</label>
          <input type="radio" id="tab-advanced" name="tabs" />
          <label for="tab-advanced">Advanced</label>

          <!-- Panels (n·∫±m c√πng cha v·ªõi radios ƒë·ªÉ CSS ƒëi·ªÅu khi·ªÉn ƒë∆∞·ª£c) -->
          <div class="tab-panels">
            <!-- GENERAL -->
            <section class="panel" data-for="tab-general">
              <div class="form-grid">
                <!-- Product Name -->
                <div class="field col-span-2">
                  <label class="field-label" for="inpName">Product Name </label>
                  <div class="pill">
                    <input
                      id="inpName"
                      type="text"
                      placeholder="e.g. Natural Glow Face Moisturizer"
                      formControlName="name"
                    />
                  </div>
                </div>

                <!-- Colors -->
                <!-- Colors -->
                <div class="color-field">
                  <label>Colors</label>

                  <!-- B·∫¢NG M√ÄU (grid) -->
                  <div class="color-palette">
                    <!-- Preset theo t√™n -->
                    <button
                      type="button"
                      class="swatch"
                      *ngFor="let c of presetColors"
                      [style.background]="colorHex(c)"
                      [class.selected]="isColorSelected(c)"
                      (click)="toggleColor(c)"
                      [attr.aria-label]="c"
                    >
                      <span *ngIf="isColorSelected(c)">‚úì</span>
                    </button>

                    <!-- Swatch cho m√†u custom (kh√¥ng tr√πng preset) -->
                    <button
                      type="button"
                      class="swatch custom"
                      *ngFor="let c of selectedColors()"
                      [style.background]="colorHex(c)"
                      class="selected"
                      (click)="toggleColor(c)"
                      [hidden]="presetColors.includes(c)"
                      [attr.aria-label]="c"
                    >
                      ‚úì
                    </button>
                  </div>

                  <!-- √î NH·∫¨P N·∫∞M D∆Ø·ªöI B·∫¢NG M√ÄU -->
                  <div class="color-add">
                    <input
                      #colorName
                      type="text"
                      placeholder="Type a color name (e.g. navy)"
                      (keyup.enter)="addColorByRef(colorName)"
                    />
                    <button
                      type="button"
                      class="add-btn"
                      (click)="addColorByRef(colorName)"
                    >
                      Ôºã
                    </button>
                  </div>

                  <div class="chosen">
                    <span class="chip" *ngFor="let c of selectedColors()">
                      <span class="dot" [style.background]="colorHex(c)"></span
                      >{{ c }}
                    </span>
                  </div>
                </div>

                <!-- Brand -->
                <div class="field">
                  <label class="field-label" for="selBrand">Brand </label>
                  <div class="pill">
                    <select id="selBrand" formControlName="brand">
                      <option
                        [ngValue]="null"
                        disabled
                        [selected]="!form.value.brand"
                      >
                        Select the brand name
                      </option>
                      <option *ngFor="let b of brands" [ngValue]="b">
                        {{ b }}
                      </option>
                    </select>
                  </div>
                </div>

                <!-- Category -->
                <div class="field">
                  <label class="field-label" for="selCategory">Category </label>
                  <div class="pill">
                    <select id="selCategory" formControlName="category">
                      <option
                        [ngValue]="null"
                        disabled
                        [selected]="!form.value.category"
                      >
                        Select main category
                      </option>
                      <option [ngValue]="'Cases'">Cases</option>
                      <option [ngValue]="'Screen Protection'">
                        Screen Protection
                      </option>
                      <option [ngValue]="'Power'">Power</option>
                      <option [ngValue]="'Accessories'">Accessories</option>
                      <option [ngValue]="'Customize'">Customize</option>
                      <option [ngValue]="'Sale'">Sale</option>
                      <option [ngValue]="'Explore'">Explore</option>
                    </select>
                  </div>
                </div>

                <!-- Subcategory -->
                <div class="field">
                  <label class="field-label" for="inpQty">Quantity</label>
                  <div class="pill">
                    <input
                      id="inpQty"
                      type="number"
                      inputmode="numeric"
                      formControlName="quantity"
                      min="1"
                      step="1"
                      placeholder="Enter quantity"
                    />
                  </div>
                </div>

                <!-- Price -->
                <div class="field">
                  <label class="field-label" for="inpPrice">Price </label>
                  <div class="pill">
                    <input
                      id="inpPrice"
                      type="text"
                      placeholder="e.g. 29.99 USD"
                      formControlName="price"
                    />
                  </div>
                </div>

                <!-- Discount + % -->
                <div class="field">
                  <label class="field-label" for="inpDiscount">Discount</label>
                  <div class="inline-unit">
                    <div class="pill">
                      <input
                        id="inpDiscount"
                        type="text"
                        placeholder="e.g. 15"
                        formControlName="discount"
                      />
                    </div>
                    <div class="unit-pill">%</div>
                  </div>
                </div>

                <!-- Description -->
                <div class="field col-span-2">
                  <label class="field-label" for="inpDesc">Description</label>
                  <div class="pill pill-textarea">
                    <textarea
                      id="inpDesc"
                      rows="5"
                      placeholder="Write a short description highlighting key benefits and features"
                      formControlName="description"
                    ></textarea>
                  </div>
                </div>
              </div>
            </section>

            <!-- ADVANCED -->
            <section class="panel" data-for="tab-advanced">
              <div class="muted">Advanced settings‚Ä¶</div>
            </section>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-outline" (click)="saveDraft()">
            Save Draft
          </button>
          <!-- d√πng submit ƒë·ªÉ k√≠ch ho·∫°t (ngSubmit) c·ªßa form -->
          <button type="submit" class="btn-primary">Publish</button>
        </div>
      </form>
    </div>
  </div>
</div>
