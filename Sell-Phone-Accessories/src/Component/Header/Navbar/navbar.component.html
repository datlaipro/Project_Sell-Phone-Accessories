<mat-toolbar class="topbar" color="transparent">
  <!-- Left: Sign In + Heart -->
  <!-- Left: Account + Heart -->
  <div class="left account" (keydown.escape)="isAccountOpen = false">
    <!-- Heart -->
   

    <!-- Login / Account icon - MOBILE ONLY -->
    <ng-container *ngIf="auth.currentUser$ | async as user; else loginIcon">
      <!-- ĐÃ ĐĂNG NHẬP: bấm để toggle menu tài khoản -->
      <button
        mat-icon-button
        class="login-btn mobile-only"
        aria-label="Account"
        type="button"
        (click)="isAccountOpen = !isAccountOpen"
      >
        <mat-icon>person</mat-icon>
      </button>
    </ng-container>

    <!-- CHƯA ĐĂNG NHẬP: bấm để đi tới /auth -->
    <ng-template #loginIcon>
      <button
        mat-icon-button
        class="login-btn mobile-only"
        aria-label="Sign in"
        [routerLink]="['/auth']"
      >
        <mat-icon>login</mat-icon>
      </button>
    </ng-template>

    <!-- Đang đăng nhập -->
    <ng-container *ngIf="auth.currentUser$ | async as user; else signInBtn">
      <button
        mat-button
        class="signin"
        type="button"
        (click)="isAccountOpen = !isAccountOpen"
        aria-haspopup="menu"
        [attr.aria-expanded]="isAccountOpen"
      >
        Hi, {{ user.name }}
        <mat-icon class="chev" [class.open]="isAccountOpen"
          >expand_more</mat-icon
        >
      </button>

      <!-- Dropdown -->
      <div class="acct-dropdown" *ngIf="isAccountOpen">
        <a
          class="item"
          [routerLink]="['/account']"
          (click)="isAccountOpen = false"
          >My Account</a
        >
        <a
          class="item"
          [routerLink]="['/orders']"
          (click)="isAccountOpen = false"
          >Order History</a
        >
        <a
          class="item"
          [routerLink]="['/wishlist']"
          (click)="isAccountOpen = false"
          >Wishlist</a
        >
        <button
          class="item"
          type="button"
          (click)="isAccountOpen = false; onLogout()"
        >
          Logout
        </button>
      </div>
    </ng-container>

    <!-- Chưa đăng nhập -->
    <ng-template #signInBtn>
      <button mat-button class="signin" [routerLink]="['/auth']">
        Sign In
      </button>
    </ng-template>

    <button mat-icon-button aria-label="Wishlist" [routerLink]="['/wishlist']">
      <mat-icon>favorite_border</mat-icon>
    </button>
  </div>

  <!-- Backdrop để click ra ngoài sẽ đóng -->
  <div
    class="backdrop"
    *ngIf="isAccountOpen"
    (click)="isAccountOpen = false"
  ></div>

  <!-- Center: Logo -->
  <div class="logo" aria-label="OtterBox" [routerLink]="['/']">OTTERBOX</div>

  <!-- Right: Search + Cart -->
  <div class="right">
    <form class="search-wrap" (ngSubmit)="onSearch()">
      <mat-form-field appearance="outline" class="search-field">
        <input
          #searchBox
          matInput
          [formControl]="search"
          placeholder="What are you looking for?"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          aria-label="Focus search"
          (click)="focusSearch()"
        >
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
      <!-- ẩn nút submit thật (Enter vẫn submit được) -->
      <button type="submit" style="display: none"></button>
    </form>

    <button
      mat-icon-button
      class="cart-btn"
      (click)="onCartClick()"
      aria-label="Cart"
      [matBadge]="cartCount"
      matBadgeOverlap="false"
    >
      <mat-icon>shopping_cart</mat-icon>
    </button>
  </div>
</mat-toolbar>
